<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#030303">
    <title>collatz-collection</title>
    <link rel="stylesheet" href="../style.css">
</head>
<body>
    <script src="../collatz.js"></script>
    <header class="center-children" style="position: absolute; left: 0; right: 0;">
        <h1 style="font-size: 40pt; text-align: center;">score<br/><span id="score">0</span></h1>
    </header>
    <div style="height: 100%; width: 50%; float: left; background: #1a1a1a;" class="center-children">
        <div>
            <h1 style="font-size: 60pt; margin: 0;" id="num1text"></h1>
            <h1 style="margin: 0; text-align: center; font-size: 35pt;" id="num1text-steps"></h1>
        </div>
    </div>
    <div style="height: 100%; width: 50%; float: right; background: transparent;" class="center-children">
        <div>
            <h1 style="font-size: 60pt; margin: 0; text-align: center;" id="num2text"></h1>
            <h1 style="margin: 0; text-align: center;">
                <a onclick="higher()" href="#" style="text-decoration: none;">mehr</a>
                <a onclick="lower()" href="#" style="text-decoration: none;">weniger</a>
            </h1>
        </div>
    </div>
    <script>
        function single_collatz_step(i) {
            if (i < 1) return -1;
            var steps = 0;
            while (true) {
                if(i == 1) return steps;
                i = i % 2 == 1 ? 3 * i + 1 : i / 2;
                steps++;
            }
        }

        var last_random;
        function random(max) {
            var result;
            do result = Math.floor(Math.random() * max);
            while(result == last_random);
            last_random = result;
            return result;
        }

        const ANIM_TIME = 75;

        var num1 = random(1000);
        var num2 = random(1000);

        var score = 0;

        const num1text = document.getElementById("num1text");
        const num1text_steps = document.getElementById("num1text-steps");
        const num2text = document.getElementById("num2text");

        async function update_text(element, num) {
            var i = 0;
            const i1 = Math.round(ANIM_TIME, 1000 / 60);
            const text1counter = setInterval(() => {
                const i2 = ++i / i1 * (2 - i / i1);
                const i3 = Math.round(num * i2);
                if(num !== i3) element.innerHTML = i3;
                if(i === i1) clearInterval(text1counter);
            }, 2 * ANIM_TIME * i / num ** 2);
        }

        function update_all_texts() {
            update_text(num1text, num1);
            update_text(num1text_steps, single_collatz_step(num1));
            update_text(num2text, num2);
            document.getElementById("score").innerHTML = score;
        }

        function go_next() {
            // Best reference to LoL, LOL
            num1 = num2;
            num2 = random(1000);
            score += 1;
            update_all_texts();
        }

        function higher() {
            if (Number(num1text_steps.innerHTML) >= single_collatz_step(num2))
                go_next();
            else {
                localStorage["score"] = score;
                window.location.href ="/game/fail";
            }
        }

        function lower() {
            if (Number(num1text_steps.innerHTML) <= single_collatz_step(num2))
                go_next();
            else {
                localStorage["score"] = score;
                window.location.href ="/game/fail";
            }
        }

        update_all_texts();
    </script>
</body>
</html>