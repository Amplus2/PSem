#!/usr/bin/env python3
from shutil import copyfile as cp

resolutions = [32, 64, 96, 128, 160, 192, 224, 256, 288, 320, 352, 384, 416, 448, 480, 512]
formats = {
    'svg': lambda r: 'inkscape -w %d -h %d $< -o tmp/$*-%d.png 2>/dev/null' % (r, r, r),
    'png': lambda r: 'convert $< -resize %dx%d tmp/$*-%d.png' % (r, r, r),
}

cp('Makefile.in', 'Makefile')
f = open('Makefile', 'a')

def cmd(c):
    f.write('\t%s\n' % c)

for e,c in formats.items():
    f.write('\n%%.ico: %%.%s\n' % e)
    cmd('@mkdir -p tmp')
    for r in resolutions:
        cmd(c(r))
    cmd('convert tmp/$*-*.png $@')

f.close()
